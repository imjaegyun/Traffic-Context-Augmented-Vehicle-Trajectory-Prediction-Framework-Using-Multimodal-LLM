import matplotlib.pyplot as plt
import numpy as np

# -------------------------------
# lane ROI 정보 (제공하신 정보 그대로)
# -------------------------------
lane_roi = {
    "Site C": {
        "A": {
            "1": [
                [0.0, 962.3529411764706],
                [0.32679738562091504, 997.3202614379085],
                [358.16993464052285, 1016.6013071895425],
                [619.281045751634, 1031.6339869281046],
                [879.7385620915032, 1046.9934640522877],
                [1056.5359477124182, 1057.124183006536],
                [1317.5550122249388, 1069.682151589242],
                [1495.5501222493886, 1075.5501222493888],
                [1747.8728606356967, 1078.7286063569682],
                [1864.4987775061122, 1077.750611246944],
                [2099.2176039119804, 1073.5941320293398],
                [2450.317848410758, 1066.2591687041565],
                [2715.354523227384, 1060.635696821516],
                [3062.2982885085576, 1053.7897310513447],
                [3334.1809290953547, 1047.9217603911982],
                [3513.8875305623474, 1044.0097799511002],
                [3695.0611246943768, 1035.4523227383863],
                [3839.0, 1022.8927680798007],
                [3839.0, 991.7206982543643],
                [3684.303178484108, 1003.9119804400979],
                [3516.0880195599025, 1012.2249388753056],
                [3350.80684596577, 1016.3814180929096],
                [3199.4621026894865, 1019.559902200489],
                [2963.031784841076, 1024.205378973105],
                [2734.914425427873, 1029.0953545232273],
                [2420.4889975550122, 1035.6968215158925],
                [2120.244498777506, 1041.5647921760392],
                [1801.1735941320292, 1046.6992665036676],
                [1535.8924205378971, 1045.476772616137],
                [1215.3545232273837, 1034.4743276283618],
                [984.3031784841074, 1020.5378973105135],
                [636.3814180929094, 1000.7334963325184],
                [319.2665036674815, 981.6625916870416]
            ],
            "2": [
                [0.47619047619047616, 996.6666666666666],
                [0.23809523809523808, 1028.5714285714284],
                [472.85714285714283, 1055.7142857142858],
                [753.0952380952381, 1072.142857142857],
                [1190.4761904761904, 1096.4285714285713],
                [1452.3809523809523, 1107.857142857143],
                [1723.5714285714284, 1111.4285714285713],
                [1987.3809523809523, 1109.047619047619],
                [2250.0, 1103.5714285714284],
                [2606.6666666666665, 1095.4761904761904],
                [2780.9523809523807, 1092.142857142857],
                [3024.285714285714, 1087.6190476190475],
                [3350.4761904761904, 1080.2380952380952],
                [3608.809523809524, 1074.047619047619],
                [3694.285714285714, 1068.3333333333333],
                [3839.0, 1054.064837905237],
                [3839.0, 1023.0952380952381],
                [3695.714285714286, 1035.7142857142858],
                [3513.095238095238, 1044.2857142857142],
                [3334.285714285714, 1048.095238095238],
                [3062.8571428571427, 1054.047619047619],
                [2715.0, 1060.952380952381],
                [2450.4761904761904, 1066.4285714285713],
                [2098.809523809524, 1073.5714285714284],
                [1863.8095238095236, 1077.857142857143],
                [1747.142857142857, 1079.047619047619],
                [1495.7142857142856, 1075.7142857142858],
                [1317.142857142857, 1069.7619047619048],
                [1056.904761904762, 1057.142857142857],
                [879.5238095238095, 1046.904761904762],
                [619.2857142857142, 1031.6666666666665],
                [358.8095238095238, 1016.9047619047618]
            ],
            "3": [
                [0.1955990220047121, 1028.606356968215],
                [0.44009779951082456, 1059.4132029339853],
                [491.6381418092908, 1088.5085574572126],
                [866.4547677261612, 1108.312958435208],
                [1121.4669926650365, 1121.2713936430318],
                [1421.2224938875304, 1134.718826405868],
                [1652.5183374083128, 1139.364303178484],
                [1949.3398533007332, 1136.919315403423],
                [2236.625916870416, 1131.5403422982886],
                [2556.919315403423, 1124.9388753056235],
                [2832.469437652812, 1119.559902200489],
                [2853.98533007335, 1118.8264058679706],
                [3008.0195599022004, 1088.0195599022006],
                [2780.1466992665037, 1092.4205378973106],
                [2606.552567237164, 1096.0880195599022],
                [2249.5843520782396, 1103.4229828850855],
                [1987.481662591687, 1109.2909535452322],
                [1722.9339853300733, 1111.7359413202935],
                [1452.0293398533006, 1108.312958435208],
                [1190.171149144254, 1096.5770171149145],
                [753.2518337408311, 1072.3716381418094],
                [472.3227383863079, 1055.9902200488998]
            ],
            "4": [
                [0.0, 1063.5411471321697],
                [0.0, 1095.7107231920202],
                [277.3067331670823, 1111.920199501247],
                [628.428927680798, 1132.1197007481298],
                [804.4887780548629, 1141.0972568578554],
                [1065.0872817955112, 1154.5635910224441],
                [1242.6433915211971, 1164.2892768079803],
                [1419.700748129676, 1171.2718204488779],
                [1595.0124688279302, 1174.7630922693268],
                [1769.8254364089776, 1175.2618453865339],
                [1943.142144638404, 1173.765586034913],
                [2119.9501246882796, 1170.5236907730675],
                [2295.511221945137, 1166.7830423940152],
                [2561.5960099750623, 1161.5461346633417],
                [2736.1596009975065, 1158.0548628428928],
                [3002.493765586035, 1153.067331670823],
                [3092.0199501246884, 1150.8229426433916],
                [3267.5810473815463, 1147.331670822943],
                [3537.1571072319202, 1139.6009975062345],
                [3625.1870324189526, 1136.1097256857856],
                [3711.4713216957607, 1130.3740648379055],
                [3806.483790523691, 1123.1421446384043],
                [3839.0, 1120.6973168582304],
                [3839.0, 1069.0274314214466],
                [3684.039900249377, 1100.1995012468828],
                [3556.6084788029925, 1108.9276807980052],
                [3319.4513715710723, 1115.1620947630925],
                [2936.907730673317, 1122.8927680798006],
                [2782.5436408977557, 1126.8827930174566],
                [2362.0947630922697, 1135.8603491271822],
                [1947.13216957606, 1143.3416458852869],
                [1566.3341645885287, 1144.5885286783043],
                [1360.3491271820449, 1138.8528678304242],
                [1029.426433915212, 1122.8927680798006],
                [649.3765586034913, 1102.4438902743143],
                [302.9925187032419, 1082.4937655860351]
            ],
            "5": [
                [0.0, 1095.4613466334167],
                [0.0, 1127.8802992518704],
                [157.356608478803, 1137.8553615960102],
                [421.94513715710724, 1152.3192019950127],
                [696.5087281795512, 1167.7805486284292],
                [961.5960099750624, 1183.4912718204491],
                [1239.1521197007482, 1199.4513715710725],
                [1423.9401496259352, 1206.4339152119703],
                [1684.28927680798, 1210.423940149626],
                [1898.503740648379, 1208.9276807980052],
                [2094.763092269327, 1205.9351620947632],
                [2480.7980049875314, 1200.69825436409],
                [2784.7880299251874, 1192.2194513715713],
                [3011.9700748129676, 1188.9775561097258],
                [3287.0324189526186, 1182.4937655860351],
                [3444.139650872818, 1176.2593516209479],
                [3717.4563591022447, 1165.5361596009977],
                [3813.9650872817956, 1157.556109725686],
                [3839.0, 1154.3963634602815],
                [3839.0, 1120.6483790523691],
                [3805.985037406484, 1123.1421446384043],
                [3710.972568578554, 1130.3740648379055],
                [3624.6882793017458, 1136.1097256857856],
                [3534.413965087282, 1140.349127182045],
                [3266.832917705736, 1147.0822942643392],
                [3091.271820448878, 1150.8229426433916],
                [2822.194513715711, 1156.3092269326685],
                [2560.847880299252, 1161.7955112219454],
                [2296.5087281795513, 1166.7830423940152],
                [2119.4513715710723, 1170.773067331671],
                [1943.142144638404, 1174.0149625935164],
                [1769.8254364089776, 1175.5112219451373],
                [1595.2618453865337, 1175.0124688279304],
                [1419.4513715710723, 1171.770573566085],
                [1242.14463840399, 1164.7880299251872],
                [1064.5885286783043, 1154.5635910224441],
                [804.4887780548629, 1141.346633416459],
                [628.1795511221945, 1131.8703241895264],
                [277.5561097256858, 1111.6708229426436]
            ],
            "6": [
                [0.2531645569620253, 1211.6455696202531],
                [41.77215189873417, 1187.3417721518986],
                [100.75949367088607, 1167.5949367088608],
                [114.43037974683544, 1165.8227848101264],
                [262.27848101265823, 1173.6708860759493],
                [468.60759493670884, 1184.5569620253164],
                [814.1772151898734, 1206.0759493670885],
                [960.253164556962, 1183.5443037974683],
                [696.2025316455696, 1167.8481012658228],
                [422.02531645569616, 1152.1518987341772],
                [157.21518987341773, 1137.7215189873418],
                [51.13924050632911, 1131.6455696202531],
                [16.962025316455694, 1145.5696202531644],
                [0.0, 1153.9240506329113]
            ],
            "safe": [
                [2853.85587863464, 1124.7534766118836],
                [3229.2035398230087, 1116.788874841972],
                [3557.142857142857, 1108.6978508217446],
                [3684.070796460177, 1099.9747155499367],
                [3791.782553729456, 1078.103666245259],
                [3839.0, 1068.4955752212388],
                [3839.0, 1063.7702909647696],
                [3838.897396630934, 1054.8085758039815],
                [3694.333843797856, 1068.4379785604901],
                [3606.278713629403, 1073.0321592649311],
                [3350.2297090352217, 1080.5359877488515],
                [3024.196018376723, 1087.427258805513],
                [3007.656967840735, 1088.0398162327717],
                [2853.75191424196, 1118.9739663093414]
            ]
        }
    }
}

def plot_lane_polygons(lane_roi, site="Site C", lane_category="A", save_path="lane_polygons.png"):
    """
    lane_roi 딕셔너리에서 해당 site와 lane_category의 모든 lane polygon을 그린 후,
    지정한 경로에 저장합니다. 배경 투명, 축/눈금/박스/라벨 등을 모두 표시하지 않음.
    """
    if site not in lane_roi or lane_category not in lane_roi[site]:
        print(f"{site}의 {lane_category} lane 정보가 없습니다.")
        return

    lanes = lane_roi[site][lane_category]
    
    # 그림 생성 시 facecolor='none'으로 설정 (도화지를 투명하게)
    fig = plt.figure(figsize=(12, 6), facecolor="none")
    ax = fig.add_subplot(111)
    ax.set_facecolor("none")  # 축 내부도 투명하게

    for lane_num, coords in lanes.items():
        # 좌표 배열을 NumPy 배열로 변환하고, 다각형이 닫히도록 첫 점을 다시 추가
        coords_arr = np.array(coords)
        coords_arr = np.vstack([coords_arr, coords_arr[0]])
        ax.plot(coords_arr[:, 0], coords_arr[:, 1])

    # y축 범위를 1450~700 구간만 보이도록 설정 (위에서 아래로 내려가는 형태)
    ax.set_ylim(1450, 700)

    # 축/눈금/스파인 등 보이지 않게 처리
    ax.axis('off')  # 이것만으로 축, 라벨, 스파인, 눈금 전부 사라짐

    # 그래프를 파일로 저장: transparent=True로 저장 시 배경 투명
    plt.savefig(save_path, dpi=300, transparent=True)
    print(f"Graph saved as {save_path}")

if __name__ == "__main__":
    plot_lane_polygons(lane_roi, site="Site C", lane_category="A")
